<Window x:Class="ESTQuestFilling.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="ESTQuestFilling"
        xmlns:view="clr-namespace:ESTQuestFilling.View"
        Name="MainWin"
        d:DesignHeight="524"
        d:DesignWidth="1055">
    <Window.Resources>
        <view:BoolToDataGridRowDetailsVisibilityModeConverter x:Key="BoolToDataGridRowDetailsVisibilityModeValueConverter"></view:BoolToDataGridRowDetailsVisibilityModeConverter>
        <view:StringToBoolVisibilityConverter x:Key="StringToBoolVisibilityConverter"></view:StringToBoolVisibilityConverter>
    </Window.Resources>
    <Grid Margin="0,0,2,10">
        <TabControl>
            <TabItem Header="Main">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"></ColumnDefinition>
                        <ColumnDefinition Width="*"></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <DockPanel HorizontalAlignment="Stretch" LastChildFill="False">
                        <Label DockPanel.Dock="Top" Content="Database read" FontWeight="Bold"/>
                        <GroupBox DockPanel.Dock="Top" Header="Database info:">
                            <StackPanel>
                                <TextBlock Margin="2" TextWrapping="Wrap" Text="{Binding DatabaseName}"></TextBlock>
                                <TextBlock Name="DatabasePathTextBox" Margin="2" TextWrapping="Wrap" Text="{Binding DatabasePath}"></TextBlock>
                            </StackPanel>
                        </GroupBox>
                        <Button DockPanel.Dock="Top" Margin="10" Command="{Binding ReadDatabaseCommand}" Height="44">Read database</Button>
                        <Label DockPanel.Dock="Top">Tables in Database:</Label>
                        <ListBox DockPanel.Dock="Top" Margin="10" Height="150" ItemsSource="{Binding DatabaseTableNamesList}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                        <Button DockPanel.Dock="Bottom" HorizontalAlignment="Right" Margin="10" Content="Exit" Width="75" Command="{Binding CloseAppCommand}"/>
                    </DockPanel>
                    <DockPanel IsEnabled="{Binding ElementName=DatabasePathTextBox, Path=Text, Converter={StaticResource StringToBoolVisibilityConverter}}" Grid.Column="1">
                        <Label DockPanel.Dock="Top" Content="Generate XML code" FontWeight="Bold"></Label>
                        <Border Margin="5" DockPanel.Dock="Top" BorderBrush="#FFA893AE" BorderThickness="2" CornerRadius="5">
                            <Border.Background>
                                <SolidColorBrush Color="#FFF5EAF5" Opacity="0.5"/>
                            </Border.Background>
                            <StackPanel DockPanel.Dock="Top" Orientation="Horizontal">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger SourceObject="{Binding ElementName=CompanyNameComboBox}" EventName="SelectionChanged">
                                        <i:InvokeCommandAction Command="{Binding ReadInstitutionCommand}" CommandParameter="{Binding ElementName=CompanyNameComboBox, Path=SelectedItem}"/>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <ComboBox x:Name="CompanyNameComboBox" Width="200" Height="25" DockPanel.Dock="Top" Margin="10,10,60,10" ItemsSource="{Binding CompanyListCollection}"/>
                                <Button DockPanel.Dock="Top" Margin="10" Content="Write to files" Height="30" Width="100"  Command="{Binding WriteInstitutionCheckpointsToFilesCommand}"/>
                            </StackPanel>
                        </Border>
                        <Label Margin="5" DockPanel.Dock="Top" MinHeight="20" Content="{Binding CurrentInstitutionName}" FontWeight="Bold" FontSize="14" BorderThickness="1" Foreground="DarkRed" HorizontalContentAlignment="Center">
                            <Label.Background>
                                <SolidColorBrush Color="#FFE3DFE4" Opacity="0.5"/>
                            </Label.Background>
                        </Label>
                        <Label DockPanel.Dock="Top">Checkpoint list:</Label>
                        <!--TODO - sprawdzić ja będzie wyglądał interface pytań jak wstawimy DataGrid w to miejsce-->
                        <Border Margin="5" BorderBrush="#FF59A8A8" DockPanel.Dock="Top" ScrollViewer.HorizontalScrollBarVisibility="Auto" ScrollViewer.VerticalScrollBarVisibility="Auto" CornerRadius="5" BorderThickness="2">
                            <ScrollViewer>
                                <ItemsControl Margin="2" DataContext="{Binding CurrentInstitution}" ItemsSource="{Binding CheckpointViewModelsList}" ScrollViewer.HorizontalScrollBarVisibility="Auto" ScrollViewer.VerticalScrollBarVisibility="Auto">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Margin="2" BorderThickness="1" BorderBrush="Black" CornerRadius="10" >
                                                <Border.Background>
                                                    <SolidColorBrush Color="#FFC4E8E8" Opacity="0.5"/>
                                                </Border.Background>
                                                <StackPanel Margin="10">
                                                    <TextBlock TextWrapping="Wrap" Text="{Binding CheckpointName}" FontWeight="Bold" FontSize="14" TextDecorations="Underline" Margin="0,0,0,10" Foreground="DarkSlateGray"/>
                                                    <ItemsControl ItemsSource="{Binding QuestionListViewModel}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <StackPanel>
                                                                    <DockPanel Margin="0,10,0,0">
                                                                        <TextBlock DockPanel.Dock="Left" FontSize="13" Text="{Binding Number}" FontWeight="Bold" Margin="0,0,5,0"/>
                                                                        <TextBlock DockPanel.Dock="Left" FontSize="13" TextWrapping="Wrap" Text="{Binding QuestionText}" TextDecorations="Underline" Margin="0,0,0,5"/>
                                                                    </DockPanel>
                                                                    <StackPanel Orientation="Horizontal" Margin="30,5,0,5">
                                                                        <TextBlock Text="Kwantyfikowanie:   "/>
                                                                        <TextBlock TextWrapping="Wrap" Text="{Binding Answer}" Foreground="#FF1811A2"/>
                                                                    </StackPanel>
                                                                    <GroupBox Header="Czynniki ryzyka">
                                                                        <TextBlock TextWrapping="Wrap" Text="{Binding Evaluation}" Margin="3"/>
                                                                    </GroupBox>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>
                    </DockPanel>
                </Grid>
            </TabItem>
            <TabItem IsEnabled="{Binding ElementName=DatabasePathTextBox, Path=Text, Converter={StaticResource StringToBoolVisibilityConverter}}" Name="QuestionDatabaseTab" Header="Questions database">
                <DockPanel>
                    <DockPanel DockPanel.Dock="Top" Margin="10,3,0,3">
                        <i:Interaction.Triggers>
                            <i:EventTrigger SourceObject="{Binding ElementName=SearchTextBox}" EventName="TextChanged">
                                <i:InvokeCommandAction Command="{Binding GetSearchedQuestionsCommand}" CommandParameter="{Binding ElementName=SearchTextBox, Path=Text}"/>
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                        <Label DockPanel.Dock="Left" Content="Search: "></Label>
                        <TextBox Name="SearchTextBox" Margin="2" DockPanel.Dock="Left" Width="300" HorizontalAlignment="Left"></TextBox>
                        <CheckBox Name="DetailViewCheckBox" DockPanel.Dock="Left" Margin="25,2,2,2" VerticalAlignment="Center">Detail view</CheckBox>
                    </DockPanel>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                        <GroupBox DockPanel.Dock="Top" Margin="5" Header="Question list">
                            <DataGrid Name="QuestionsDataGrid" RowDetailsVisibilityMode="{Binding ElementName=DetailViewCheckBox, Path=IsChecked, Converter={StaticResource BoolToDataGridRowDetailsVisibilityModeValueConverter}}" ItemsSource="{Binding SearchQuestionCollection, UpdateSourceTrigger=PropertyChanged}" AutoGenerateColumns="False" ScrollViewer.CanContentScroll="False">
                                <DataGrid.Columns>
                                    <DataGridTextColumn x:Name="QuestionTextDataGridTextColumn" Width="800"  Header="Pytanie" Binding="{Binding QuestionText, Mode=OneWay}" IsReadOnly="True" />
                                    <DataGridTextColumn x:Name="AnswerDataGridTextColumn" Width="300" Header="Kwantyfikowanie" Binding="{Binding Answer, Mode=OneWay}" IsReadOnly="True" />
                                </DataGrid.Columns>
                                <DataGrid.RowDetailsTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="{Binding ElementName=QuestionTextDataGridTextColumn, Path=ActualWidth}"></ColumnDefinition>
                                                <ColumnDefinition Width="{Binding ElementName=AnswerDataGridTextColumn, Path=ActualWidth}"></ColumnDefinition>
                                            </Grid.ColumnDefinitions>
                                            <GroupBox Grid.Column="0" Header="Czynniki ryzyka">
                                                <TextBlock Text="{Binding Evaluation}" Margin="5" />
                                            </GroupBox>
                                            <GroupBox Grid.Column="1" Header="Tag">
                                                <GroupBox.Background>
                                                    <SolidColorBrush Color="#FFEEE8E8" Opacity="0.5"/>
                                                </GroupBox.Background>
                                                <TextBlock TextWrapping="Wrap" Text="{Binding Tag}" Margin="5"/>
                                            </GroupBox>
                                        </Grid>
                                    </DataTemplate>
                                </DataGrid.RowDetailsTemplate>
                            </DataGrid>
                        </GroupBox>
                    </ScrollViewer>
                </DockPanel>
            </TabItem>
            <TabItem IsEnabled="{Binding ElementName=DatabasePathTextBox, Path=Text, Converter={StaticResource StringToBoolVisibilityConverter}}" Name="RiskFactorsTab" Header="Risk Factors">
                <DockPanel>
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                        <GroupBox DockPanel.Dock="Top" Margin="5" Header="Risk Factors List">
                            <DataGrid Name="RiskFactorsDataGrid" ItemsSource="{Binding RiskFactors}" AutoGenerateColumns="False" ScrollViewer.CanContentScroll="False">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Width="50"  Header="Numer" Binding="{Binding Number, Mode=OneWay}" IsReadOnly="True" />
                                    <DataGridTextColumn Width="200" Header="Obszar ryzyka" Binding="{Binding RiskField, Mode=OneWay}" IsReadOnly="True" />
                                    <DataGridTextColumn Width="300" Header="Kategoria ryzyka" Binding="{Binding RiskCategory, Mode=OneWay}" IsReadOnly="True" />
                                    <DataGridTextColumn Width="400" Header="Czynnik ryzyka" Binding="{Binding RiskFactorName, Mode=OneWay}" IsReadOnly="True" />
                                    <DataGridTextColumn Width="50" Header="EST ID" Binding="{Binding EST_ID, Mode=OneWay}" IsReadOnly="True" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </GroupBox>
                    </ScrollViewer>
                </DockPanel>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
